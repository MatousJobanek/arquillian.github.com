<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Testing Java Persistence &#183; Arquillian Guides</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Test your data! Learn how to test Java Persistence (JPA) queries against multiple providers in an Arquillian test." name="description" />
    <link href="/blog/atom.xml" rel="alternate" title="Arquillian blog Atom feed" type="application/atom+xml" />
    <link href="/stylesheets/screen.css?561598d61dc65317bc7ec8c4030edffad9a55082" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.js"></script>
    <![endif]-->
    <link href="/favicon.ico" rel="shortcut icon" />
  </head>
  <body class="guide">
    <header class="navbar navbar-fixed-top" id="banner" role="banner">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="g-plusone-slot">
            <div class="g-plusone" data-annotation="none"></div>
          </div>
          <a class="brand" href="/">
            <span class="logo"></span>
            <span class="name">Arquillian</span>
          </a>
          <nav class="nav-collapse" role="navigation">
            <ul class="nav">
              <li><a href="/invasion/">Invasion!</a></li>
              <li><a href="/features/">Features</a></li>
              <li class="active"><a href="/guides/">Guides</a></li>
              <li><a href="/docs/">Docs</a></li>
              <li><a href="/blog/">Blog</a></li>
              <li><a href="/community/">Community</a></li>
              <li><a href="/modules/">Modules</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
    <div id="main" role="main">
      <div id="content-header">
        <div class="container">
          <div class="headline">
            <h1>
              <a href="/guides/">Arquillian Guides</a>
              <small>Designed exclusively to teach you how to use Arquillian to write real tests.</small>
            </h1>
            <div class="directory">
              <a class="guides_menu" href="./" id="guides_menu">
                Guides Index
                <i class="icon-menu-closed"></i>
              </a>
              <div id="guides" style="display: none">
                <a class="guides_menu" href="./">
                  Guides Index
                  <i class="icon-menu-open"></i>
                </a>
                <hr class="clear" />
                <dl class="beg">
                  <dt>First Steps</dt>
                  <dd><a href="/guides/getting_started/">Getting Started</a>
                  <br />
                  <a href="/guides/getting_started/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/getting_started_de/"><img class="flag" rel="tooltip" src="/images/flags/de.png" title="Deutsch (de)" /></a>
                  <a href="/guides/getting_started_el_gr/"><img class="flag" rel="tooltip" src="/images/flags/el_gr.png" title="Ελληνικά (el_gr)" /></a>
                  <a href="/guides/getting_started_es/"><img class="flag" rel="tooltip" src="/images/flags/es.png" title="Español (es)" /></a>
                  <a href="/guides/getting_started_fr/"><img class="flag" rel="tooltip" src="/images/flags/fr.png" title="Française (fr)" /></a>
                  <a href="/guides/getting_started_it/"><img class="flag" rel="tooltip" src="/images/flags/it.png" title="Italiano (it)" /></a>
                  <a href="/guides/getting_started_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/getting_started_nl/"><img class="flag" rel="tooltip" src="/images/flags/nl.png" title="Nederlands (nl)" /></a>
                  <a href="/guides/getting_started_pl/"><img class="flag" rel="tooltip" src="/images/flags/pl.png" title="Polski (pl)" /></a>
                  <a href="/guides/getting_started_pt/"><img class="flag" rel="tooltip" src="/images/flags/pt.png" title="Português (pt)" /></a>
                  <a href="/guides/getting_started_sk/"><img class="flag" rel="tooltip" src="/images/flags/sk.png" title="Slovenčina (sk)" /></a>
                  <a href="/guides/getting_started_sv_se/"><img class="flag" rel="tooltip" src="/images/flags/sv_se.png" title="Svenska (sv_se)" /></a>
                  <a href="/guides/getting_started_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/getting_started_rinse_and_repeat/">Getting Started: Rinse and Repeat</a>
                  <br />
                  <a href="/guides/getting_started_rinse_and_repeat/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_de/"><img class="flag" rel="tooltip" src="/images/flags/de.png" title="Deutsch (de)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_es/"><img class="flag" rel="tooltip" src="/images/flags/es.png" title="Español (es)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_fr/"><img class="flag" rel="tooltip" src="/images/flags/fr.png" title="Française (fr)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_it/"><img class="flag" rel="tooltip" src="/images/flags/it.png" title="Italiano (it)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_pl/"><img class="flag" rel="tooltip" src="/images/flags/pl.png" title="Polski (pl)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_pt/"><img class="flag" rel="tooltip" src="/images/flags/pt.png" title="Português (pt)" /></a>
                  <a href="/guides/getting_started_rinse_and_repeat_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/get_started_faster_with_forge/">Get Started Faster with Forge</a></dd>
                  <dd><a href="/guides/shrinkwrap_introduction/">Creating Deployable Archives with ShrinkWrap</a>
                  <br />
                  <a href="/guides/shrinkwrap_introduction/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/shrinkwrap_introduction_de/"><img class="flag" rel="tooltip" src="/images/flags/de.png" title="Deutsch (de)" /></a>
                  <a href="/guides/shrinkwrap_introduction_fr/"><img class="flag" rel="tooltip" src="/images/flags/fr.png" title="Française (fr)" /></a>
                  <a href="/guides/shrinkwrap_introduction_it/"><img class="flag" rel="tooltip" src="/images/flags/it.png" title="Italiano (it)" /></a>
                  <a href="/guides/shrinkwrap_introduction_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/shrinkwrap_introduction_pl/"><img class="flag" rel="tooltip" src="/images/flags/pl.png" title="Polski (pl)" /></a>
                  <a href="/guides/shrinkwrap_introduction_pt/"><img class="flag" rel="tooltip" src="/images/flags/pt.png" title="Português (pt)" /></a>
                  <a href="/guides/shrinkwrap_introduction_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                </dl>
                <dl class="int">
                  <dt>More Coverage</dt>
                  <dd><a href="/guides/testing_java_persistence/">Testing Java Persistence</a>
                  <br />
                  <a href="/guides/testing_java_persistence/"><img class="flag" rel="tooltip" src="/images/flags/en.png" title="English (en)" /></a>
                  <a href="/guides/testing_java_persistence_de/"><img class="flag" rel="tooltip" src="/images/flags/de.png" title="Deutsch (de)" /></a>
                  <a href="/guides/testing_java_persistence_es/"><img class="flag" rel="tooltip" src="/images/flags/es.png" title="Español (es)" /></a>
                  <a href="/guides/testing_java_persistence_fr/"><img class="flag" rel="tooltip" src="/images/flags/fr.png" title="Française (fr)" /></a>
                  <a href="/guides/testing_java_persistence_ja/"><img class="flag" rel="tooltip" src="/images/flags/ja.png" title="日本 (ja)" /></a>
                  <a href="/guides/testing_java_persistence_zh_cn/"><img class="flag" rel="tooltip" src="/images/flags/zh_cn.png" title="简体中文 (zh_cn)" /></a></dd>
                  <dd><a href="/guides/functional_testing_using_graphene/">Functional Testing using Drone and Graphene</a></dd>
                  <dd><a href="/guides/testing_in_the_cloud/">Testing in the Cloud</a></dd>
                </dl>
                <dl class="adv">
                  <dt>Enhance</dt>
                  <dd><a href="/guides/developing_a_container_adapter/">Developing a Container Adapter</a></dd>
                </dl>
                <dl class="ref">
                  <dt>Reference</dt>
                  <dd><a href="https://docs.jboss.org/author/display/ARQ/Reference+Guide">Reference Guide</a></dd>
                  <dd><a href="http://docs.jboss.org/arquillian/aggregate/latest">API &amp; SPI Docs</a></dd>
                  <dd><a href="http://community.jboss.org/wiki/ArquillianMigrationGuides">Migration Guides</a></dd>
                  <dd><a href="http://community.jboss.org/en/arquillian/faq">FAQs</a></dd>
                </dl>
              </div>
            </div>
            <script>$(function() { activateGuideMenuControl() })</script>
          </div>
        </div>
      </div>
      <div class="container" id="guide">
        <div id="content" lang="es">
            <div class="header">
            <div class="titlebar">
            <h2>Testing Java Persistence</h2>
            <div class="btn-group">
              <a class="btn" href="https://github.com/arquillian/arquillian.github.io/edit/develop/guides/testing_java_persistence_es.textile">Edit this file</a>
            </div>
          </div>
            <div class="authors"><strong>Authors:</strong>
          <a href="/community/mojavelinux">Dan Allen</a>, <a href="/community/bartoszmajsak">Bartosz Majsak</a>, <a href="/community/hasalex">Alexis Hassler</a>  <strong style="padding-left: 10px;">Translator:</strong>
          <a href="/community/csierra">Carlos Sierra Andrés</a>  <strong style="padding-left: 10px;">Language:</strong>
          <img class="flag" rel="tooltip" src="/images/flags/es.png" title="Español (es)" />
          <br />
          <strong style="padding-left: 0px;">Tags:</strong>
          jpa, database, persistence, transactions  <strong style="padding-left: 10px;">Last Update:</strong>Feb 26, 2017</div>
            <p>Esta guía te enseñará cómo usar Arquillian para probar tu capa de persistencia de datos (JPA). Después de leer esta guía serás capaz de:</p>
            <ul>
          	<li>Crear un archivo de test que incluya un descriptor JPA (persistence.xml)</li>
          	<li>Inyectar EntityManager y UserTransaction en tu test</li>
          	<li>Persistir entidades y recuperarlas después usando JPQL y el API de Criteria de JPA 2</li>
          	<li>Ejecutar los tests usando diferentes proveedores de JPA</li>
          </ul>
            <p>Pronto descubrirás que Arquillian es el escenario perfecto para probar JPA o, simplemente, experimentar cómo funciona. Hemos diseñado esta guía para que sea fácil de seguir y que puedas volver a ella cuando necesites afianzar la parte de JPA.</p>
            </div>
            <h3 id="asunciones">Asunciones</h3>
          <p>Asumiremos que has leído o la <a href="/guides/getting_started_es">Guía de introducción</a> o la guía <a href="/guides/get_started_faster_with_forge">Get Started Faster with Forge</a> y que ya tienes una configuración de tests de Arquillian en un proyecto de Maven. Si quieres puedes borrar las clases Java para hacer hueco para la nueva lección. Añadiremos una entidad JPA al proyecto para crear un test básico de persistencia (JPA). Desde ese punto podrás usar estar instrucciones para testear otras entidades.</p>
          <p>Las instrucciones contenidas en esta guía son específicas para un proyecto Maven. Sin embargo recuerda que Arquillian no depende de Maven de ninguna manera. Ejecutaremos los test en Glassfish embebido y en una instancia JBoss AS 7 local.</p>
          <p class="warning"><span>No puedes usar el perfil arquillian-weld-ee-embedded en este tutorial ya que Weld no proporciona el servicio JPA (Weld solo proporciona CDI).</span></p>
          <h3 id="prop&#243;sito">Propósito</h3>
          <p>La aplicación tiene una entidad (video) <code>Game</code> que tiene dos campos:</p>
          <ul>
          	<li><code>id</code> &#8211; la clave primaria</li>
          	<li><code>title</code> &#8211; el título del juego</li>
          </ul>
          <p>Escribiremos un test que persista entradas de prueba en la base de datos y que después las consulte usando tanto JPQL como el API de Criteria de JPA. Cuando terminemos, el test realizará las siguientes tareas:</p>
          <ul>
          	<li>guardará entidades de prueba en la base de datos usando el <code>EntityManager</code> de JPA.</li>
          	<li>consultará la base de datos usando JPQL</li>
          	<li>consultará la base de datos usando el API de Criteria de JPA</li>
          </ul>
          <p>El código fuente completo está disponible en el  <a href="http://github.com/arquillian/arquillian-examples/tree/master/arquillian-persistence-tutorial">Proyecto de ejemplos de Arquillian</a> en github. Si quieres verlo en acción lo único que tienes que hacer es ejecutar el siguiente comando (y tener un poco de paciencia mientras que Maven descarga las dependencias).</p>
          <pre class="command"><code class="command">mvn test</code></pre>
          <p>Profundicemos para ver cómo funciona esto.</p>
          <h3 id="estructura_del_proyecto">Estructura del proyecto</h3>
          <p>Para que te vayas aclimatando, aquí tienes la estructura de directorios del proyecto:</p>
          <ul class="filetree">
          	<li>src/
          	<ul>
          		<li>main/
          		<ul>
          			<li>java/
          			<ul>
          				<li>org/
          				<ul>
          					<li>arquillian/
          					<ul>
          						<li>example/
          						<ul>
          							<li>Game.java</li>
          						</ul></li>
          					</ul></li>
          				</ul></li>
          			</ul></li>
          			<li>resources/
          			<ul>
          				<li>META-INF/
          				<ul>
          					<li>persistence.xml</li>
          				</ul></li>
          			</ul></li>
          		</ul></li>
          		<li>test/
          		<ul>
          			<li>java/
          			<ul>
          				<li>org/
          				<ul>
          					<li>arquillian/
          					<ul>
          						<li>example/
          						<ul>
          							<li>GamePersistenceTest.java</li>
          						</ul></li>
          					</ul></li>
          				</ul></li>
          			</ul></li>
          			<li>resources/
          			<ul>
          				<li>arquillian.xml</li>
          			</ul></li>
          			<li>resources-glassfish-embedded/
          			<ul>
          				<li>glassfish-resources.xml</li>
          				<li>logging.properties</li>
          				<li>test-persistence.xml</li>
          			</ul></li>
          			<li>resources-jbossas-managed/
          			<ul>
          				<li>test-persistence.xml</li>
          			</ul></li>
          		</ul></li>
          	</ul></li>
          	<li>pom.xml</li>
          </ul>
          <p><code>Game</code> es la clase de la entidad JPA y test-persistence.xml es una versión modificada del persistence.xml que proporciona la definición de nuestra Persistence Unit (Unidad de Persistencia) para el entorno de tests. Date cuenta de que hay dos carpetas de tests que contienen sendos ficheros test-persistence.xml, uno para cada contenedor que vamos a usar. Explicaremos aquellos que elijamos más adelante.</p>
          <p>Como buena práctica recomendamos usar un descriptor JPA dedicado para los tests, para poder ajustarlos a los diferentes DataSource y configurar tu proveedor de persistencia de manera distinta al escenario de producción. Por ejemplo, en el entorno de tests, puede que quieras usar una estrategía de &#8220;crea-y-borra-tablas&#8221; para gestionar el esquema de la base de datos. Puede que también quieras ver las queries a la base de datos en la salida de log. Estas configuraciones se pueden activar en los test-persistence.xml sin que afecten a la aplicación principal, como podrás ver más adelante. No tocaremos para nada el persistence.xml principal, ya que esa es la definición del entorno de producción.</p>
          <p>Aquí está el código de la clase de la entidad <code>Game</code>, como indica la anotacion <code>@Entity</code>:</p>
          <div class="filename">src/main/resources/org/arquillian/example/Game.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A; &#x000A;<code class="prettify">import java.io.Serializable;&#x000A;import javax.persistence.Entity;&#x000A;import javax.persistence.GeneratedValue;&#x000A;import javax.persistence.Id;&#x000A;import javax.validation.constraints.NotNull;&#x000A;import javax.validation.constraints.Size;</code>&#x000A; &#x000A;<code class="prettify">@Entity&#x000A;public class Game implements Serializable {&#x000A;    private Long id;&#x000A;    private String title;</code>&#x000A; &#x000A;<code class="prettify">    public Game() {}</code>&#x000A; &#x000A;<code class="prettify">    public Game(String title) {&#x000A;        this.title = title;&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    @Id @GeneratedValue&#x000A;    public Long getId() {&#x000A;        return id;&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    public void setId(Long id) {&#x000A;        this.id = id;&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    @NotNull&#x000A;    @Size(min = 3, max = 50)&#x000A;    public String getTitle() {&#x000A;        return title;&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    public void setTitle(String title) {&#x000A;        this.title = title;&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    @Override&#x000A;    public String toString() {&#x000A;        return "Game@" + hashCode() + "[id = " + id + "; title = " + title + "]";&#x000A;    }&#x000A;}</code></pre>
          <p>La clave primaria se define usando la anotación <code>@Id</code> en el campo. Las columnas adicionales se obtienen directamente por las propiedades del bean (la convención estándar de getters y setters). Puedes usar la anotación <code>@Column</code> para poner explícitamente el nombre a una columna. Si no, el nombre de la columna se obtendrá quitando el prefijo &#8220;get&#8221; al nombre del método de lectura de la propiedad del bean y poniendo en minúsculas el primer carácter del resto (por ej: getTitle() &rarr; title).</p>
          <p>También vamos a usar las anotaciones estándar de validación para forzar las restricciones. En nuestro caso el título es un campo obligatorio y debe tener entre 3 y 50 caracteres de longitud. (Nota: de aquí también se puede coger una buena idea para otro test).</p>
          <h3 id="escribir_el_test">Escribir el test</h3>
          <p>Hablando de tests, vamos a crear un nuevo caso de test de JUnit 4 con Arquillian, <code>GamePersistenceTest</code>, y lo vamos a preparar para probar nuestras operaciones JPA. Vamos a utilizar <a href="http://docs.jboss.org/cdi/spec/1.0/html" title="JSR-299">CDI</a> para que nos proporcione los recursos que necesitamos via inyección de dependencias. (También podrías usar herramientas EJB para manejar los límites de la transacción. Esto lo veremos en una guía posterior).</p>
          <div class="filename">src/test/java/org/arquillian/example/GamePersistenceTest.java</div>
          <pre class="prettify"><code class="prettify">package org.arquillian.example;</code>&#x000A;&#x000A;<code class="prettify">import java.util.List;&#x000A;import javax.inject.Inject;&#x000A;import javax.persistence.EntityManager;&#x000A;import javax.persistence.PersistenceContext;&#x000A;import javax.transaction.UserTransaction;&#x000A;import org.jboss.arquillian.container.test.api.Deployment;&#x000A;import org.jboss.arquillian.junit.Arquillian;&#x000A;import org.jboss.shrinkwrap.api.Archive;&#x000A;import org.jboss.shrinkwrap.api.ShrinkWrap;&#x000A;import org.jboss.shrinkwrap.api.asset.EmptyAsset;&#x000A;import org.jboss.shrinkwrap.api.spec.WebArchive;&#x000A;import org.junit.runner.RunWith;</code>&#x000A;&#x000A;<code class="prettify">@RunWith(Arquillian.class)&#x000A;public class GamePersistenceTest {&#x000A;    @Deployment&#x000A;    public static Archive&lt;?&gt; createDeployment() {&#x000A;        return ShrinkWrap.create(WebArchive.class, "test.war")&#x000A;            .addPackage(Game.class.getPackage())&#x000A;            .addAsResource("test-persistence.xml", "META-INF/persistence.xml")&#x000A;            .addAsWebInfResource(EmptyAsset.INSTANCE, "beans.xml");&#x000A;    }</code>&#x000A; &#x000A;<code class="prettify">    private static final String[] GAME_TITLES = {&#x000A;        "Super Mario Brothers",&#x000A;        "Mario Kart",&#x000A;        "F-Zero"&#x000A;    };</code>&#x000A;    &#x000A;<code class="prettify">    @PersistenceContext&#x000A;    EntityManager em;</code>&#x000A;    &#x000A;<code class="prettify">    @Inject&#x000A;    UserTransaction utx;</code>&#x000A; &#x000A;<code class="prettify">    // tests go here&#x000A;}</code></pre>
          <p>Comencemos trabajando de arriba a abajo para entender qué está pasando aquí antes de pasar a los tests.</p>
          <dl>
          	<dt>@RunWith(Arquillian.class)</dt>
          	<dd>Le dice a JUnit que delegue la ejecución de los tests al ejecutor de tests de Arquillian. Esto permite a Arquillian proporcionar los componentes del modelo para tu test, que consisten en un gestor de ciclos de vida administrado por el contenedor y la inyección de dependencias, entre otros. Date cuenta de que no es necesario que heredes de una clase padre, dejando esa puerta abierta para otros usos.</dd>
          	<dt>@Deployment method</dt>
          	<dd>Construye y devuelve un archivo de &#8220;micro despliegue&#8221; usando <a href="http://jboss.org/shrinkwrap">ShrinkWrap</a>. Arquillian despliega este archivo, y empaqueta el test y alguna infraestructura adicional, en el contenedor. Después el test se ejecuta como un componente de esta microaplicación. Los contenidos de este archivo se convierten en un mundo aislado para el test.</dd>
          	<dt>Constante GAME_TITLES</dt>
          	<dd>Los datos de prueba</dd>
          	<dt>@PersistenceContext EntityManager</dt>
          	<dd>Inyecta el contexto de persistencia (p.ej: <code>EntityManager</code>) directamente en el test, como si el test fuera un <a href="http://download.oracle.com/javaee/6/api/javax/annotation/ManagedBean.html" title="Managed Bean">Bean Gestionado</a>.</dd>
          	<dt>@Inject UserTransaction</dt>
          	<dd>Inyecta una transacción JTA directamente al test, un servicio proporcionado a los beans gestionados por CDI (JSR-299).</dd>
          </dl>
          <p>Para evitar embarrar la logica del test con configuración de la persistencia vamos a introducir métodos interceptores que se ejecutarán antes y después de la ejecución de cada test. Echemos un vistazo a este código transversal:</p>
          <p>El método <code>@Before</code>, invocado antes de cada test, realiza las siguientes tareas:</p>
          <ol>
          	<li>Limpia el estado de la base de datos para evitar que queden datos de una ejecución anterior.</li>
          	<li>Inserta datos de ejemplo necesarios para el test.</li>
          	<li>Comienza una transacción.</li>
          </ol>
          <p>Aquí van los métodos que añadiremos al caso de test, junto con una sentencia importante:</p>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;import org.junit.Before;&#x000A;&lt;!-- clip --&gt;</code>&#x000A;&#x000A;<code class="prettify">@Before&#x000A;public void preparePersistenceTest() throws Exception {&#x000A;    clearData();&#x000A;    insertData();&#x000A;    startTransaction();&#x000A;}</code>&#x000A;&#x000A;<code class="prettify">private void clearData() throws Exception {&#x000A;    utx.begin();&#x000A;    em.joinTransaction();&#x000A;    System.out.println("Descartando registros obsoletos...");&#x000A;    em.createQuery("delete from Game").executeUpdate();&#x000A;    utx.commit();&#x000A;}</code>&#x000A;&#x000A;<code class="prettify">private void insertData() throws Exception {&#x000A;    utx.begin();&#x000A;    em.joinTransaction();&#x000A;    System.out.println("Insertando registros...");&#x000A;    for (String title : GAME_TITLES) {&#x000A;        Game game = new Game(title);&#x000A;        em.persist(game);&#x000A;    }&#x000A;    utx.commit();&#x000A;    // Vacía el contexto de persistencia (cache de primer nivel)&#x000A;    em.clear();&#x000A;}</code>&#x000A;&#x000A;<code class="prettify">private void startTransaction() throws Exception {&#x000A;    utx.begin();&#x000A;    em.joinTransaction();&#x000A;}</code></pre>
          <p>Necesitamos también un método para confirmar la transacción después de cada test, lo que requiere un <em>import</em> adicional:</p>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;import org.junit.After;&#x000A;&lt;!-- clip --&gt;</code>&#x000A;&#x000A;<code class="prettify">@After&#x000A;public void commitTransaction() throws Exception {&#x000A;    utx.commit();&#x000A;}</code></pre>
          <p>Arquillian ejecuta los métodos <code>@Before</code> y <code>@After</code> dentro del contenedor, antes y después de cada método de test, respectivamente. El método <code>@Before</code> se invoca una vez que se han realizado las inyecciones de dependencias.</p>
          <p>Date cuenta de que tenemos que registrar al <code>EntityManager</code> en la transacción JTA. Este paso es necesario ya que estamos usando los dos recursos de manera independiente. Esto puede que te resulte extraño si estás acostumbrado a usar JPA dentro de EJB, dónde este registro ocurre de forma automática.</p>
          <h4>Consultar con JPQL</h4>
          <p>Aquí está el test que nos permite verificar que podemos consultar registros de prueba usando JPQL. Imprimiremos algunas entradas en el log para que puedas ver lo que está pasando.</p>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;import java.util.List;&#x000A;import org.junit.Test;&#x000A;&lt;!-- clip --&gt;</code>&#x000A;&#x000A;<code class="prettify">@Test&#x000A;public void shouldFindAllGamesUsingJpqlQuery() throws Exception {&#x000A;    // Dado que (given)&#x000A;    String fetchingAllGamesInJpql = "select g from Game g order by g.id";</code>&#x000A;&#x000A;<code class="prettify">    // cuando (when)&#x000A;    System.out.println("Consultando (usando JPQL)...");&#x000A;    List&lt;Game&gt; games = em.createQuery(fetchingAllGamesInJpql, Game.class).getResultList();</code>&#x000A;&#x000A;<code class="prettify">    // entonces (then)&#x000A;    System.out.println("Encontrado(s) " + games.size() + " juegos (usando JPQL):");&#x000A;    assertContainsAllGames(games);&#x000A;}</code></pre>
          <p>Terminamos el test con una llamada a <code>assertContainsAllGames</code>. Este es un método propio de verificación que se asegura de que la colección obtenida en la consulta contiene todos los títulos almacenados en la base de datos.</p>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;import java.util.Arrays;&#x000A;import java.util.Collection;&#x000A;import java.util.HashSet;&#x000A;import java.util.Set;&#x000A;import org.junit.Assert;&#x000A;&lt;!-- clip --&gt;</code>&#x000A;&#x000A;<code class="prettify">private static void assertContainsAllGames(Collection&lt;Game&gt; retrievedGames) {&#x000A;    Assert.assertEquals(GAME_TITLES.length, retrievedGames.size());&#x000A;    final Set&lt;String&gt; retrievedGameTitles = new HashSet&lt;String&gt;();&#x000A;    for (Game game : retrievedGames) {&#x000A;        System.out.println("* " + game);&#x000A;        retrievedGameTitles.add(game.getTitle());&#x000A;    }&#x000A;    Assert.assertTrue(retrievedGameTitles.containsAll(Arrays.asList(GAME_TITLES)));&#x000A;}</code></pre>
          <p>El beneficio de tener un método de verificación independiente es doble:</p>
          <ul>
          	<li>Muestra claramente qué es lo que estamos esperando</li>
          	<li>Se puede reutilizar en otros tests</li>
          </ul>
          <p>¡Ahora vamos a por otra funcionalidad de JPA 2, el API de Criteria!</p>
          <h4>Generar el Metamodelo de JPA 2</h4>
          <p>Al usar el API de Criteria, idealmente hay que utilizar las classes del Metamodelo de JPA 2 para mantenerlo todo &#8220;a prueba de tipos&#8221;(type-safe). Para generar estas clases en Maven tenemos primero que convencerlo de que use JDK 6 (Sí, es así de cabezota).</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;build&gt;&#x000A;    &lt;plugins&gt;&#x000A;        &lt;plugin&gt;&#x000A;            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;&#x000A;            &lt;version&gt;2.3.2&lt;/version&gt;&#x000A;            &lt;configuration&gt;&#x000A;                &lt;source&gt;1.6&lt;/source&gt;&#x000A;                &lt;target&gt;1.6&lt;/target&gt;&#x000A;            &lt;/configuration&gt;&#x000A;        &lt;/plugin&gt;&#x000A;    &lt;/plugins&gt;&#x000A;&lt;/build&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p>Tenemos también que configurar Maven para que ejecute el procesador de anotaciones de JPA 2.Lo conseguimos añadiendo simplemente el generador de metamodelos JPA de Hibernate como una dependencia de tiempo de compilación:</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;dependency&gt;&#x000A;    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;&#x000A;    &lt;artifactId&gt;hibernate-jpamodelgen&lt;/artifactId&gt;&#x000A;    &lt;version&gt;1.2.0.Final&lt;/version&gt;&#x000A;    &lt;scope&gt;provided&lt;/scope&gt;&#x000A;&lt;/dependency&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p class="info"><span>El generador del metamodelo se ejecutará automáticamente si usas un compilador JDK 6 y el jar del procesador de anotaciones se encuentra en el classpath</span></p>
          <p>Conseguir que funcione el generador del metamodel de JPA 2 en Eclipse en un poco más enrevesado. Comienza creando un fichero que se llame .factorypath en la raíz del proyecto y rellénalo con la siguiente configuración:</p>
          <div class="filename">.factorypath</div>
          <pre class="prettify"><code class="prettify">&lt;factorypath&gt;&#x000A;    &lt;factorypathentry kind="VARJAR" enabled="true" runInBatchMode="false"&#x000A;        id="M2_REPO/org/hibernate/hibernate-jpamodelgen/1.2.0.Final/hibernate-jpamodelgen-1.2.0.Final.jar"/&gt;&#x000A;    &lt;factorypathentry kind="VARJAR" enabled="true" runInBatchMode="false"&#x000A;        id="M2_REPO/org/hibernate/javax/persistence/hibernate-jpa-2.0-api/1.0.0.Final/hibernate-jpa-2.0-api-1.0.0.Final.jar"/&gt;&#x000A;&lt;/factorypath&gt;</code></pre>
          <p>Después haz click con el botón derecho sobre el proyecto y selecciona Properties. Expande el nodo del Java Compiler en el arbol de propiedades y selecciona Annotation Processing. Cambia los valores siguientes:</p>
          <ul>
          	<li>Marca la casilla &#8220;Enable project specific settings&#8221;</li>
          	<li>Marca la casilla &#8220;Enable annotation processing&#8221;</li>
          	<li>Pon &#8220;target/generated-sources/annotations&#8221; en &#8220;Generated source directory&#8221;  (sin las comillas)</li>
          	<li>Haz click en el botón Apply y acepta <em>full build</em> (compilación completa)</li>
          	<li>Desmarca la casilla &#8220;Enable annotation processing&#8221;</li>
          	<li>Haz click en el botón Apply y sáltate(skip) el <em>full build</em></li>
          	<li>Marca la casilla &#8220;Enable annotation processing&#8221;</li>
          	<li>Haz click en el botón Apply y acepta <em>full build</em> (compilación completa)</li>
          </ul>
          <p>Ahora deberías ver <code>Game_.java</code> en el directorio target/generated-sources/annotations, el cuál debería estar también en el classpath.</p>
          <p class="info"><span>Sí, hay que cacharrear un poco con esto, como cuándo tienes que dar patadas a la maquina de vending para que caiga la chocolatina ~:). Si es demasiado problema siempre puedes saltarte la generación del metamodelo y simplemente referirte a los nombre de las columnas usando strings.</span></p>
          <p>¡Al fin! ¡Estás listo para escribir la consulta!</p>
          <h4>Consulta con el API de Criteria</h4>
          <p>Aquí hay una copia del test anterior que ha sido actualizada para usar el API de Criteria. Date cuenta que este test depende de que el procesador de anotaciones de JPA 2 haya generado la clase del metamodelo <code>Game_</code> durante la compilación.</p>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;import javax.persistence.criteria.CriteriaBuilder;&#x000A;import javax.persistence.criteria.CriteriaQuery;&#x000A;import javax.persistence.criteria.Root;&#x000A;&lt;!-- clip --&gt;</code>&#x000A;&#x000A;<code class="prettify">@Test&#x000A;public void shouldFindAllGamesUsingCriteriaApi() throws Exception {&#x000A;    // dado (given)&#x000A;    CriteriaBuilder builder = em.getCriteriaBuilder();&#x000A;    CriteriaQuery&lt;Game&gt; criteria = builder.createQuery(Game.class);</code>&#x000A;    		&#x000A;<code class="prettify">    Root&lt;Game&gt; game = criteria.from(Game.class);&#x000A;    criteria.select(game);&#x000A;    // TIP: Si no quieres usar el metamodelo de JPA 2&#x000A;    // puedes cambiar la llamada al método get() por get("id")&#x000A;    criteria.orderBy(builder.asc(game.get(Game_.id)));&#x000A;    // Sin cláusula WHERE , lo que implica select all</code>&#x000A;&#x000A;<code class="prettify">    // cuando (when)&#x000A;    System.out.println("Consultando (usando Criteria)...");&#x000A;    List&lt;Game&gt; games = em.createQuery(criteria).getResultList();</code>&#x000A;&#x000A;<code class="prettify">    // entonces (then)&#x000A;    System.out.println("Encontrado(s) " + games.size() + " juegos (usando Criteria):");&#x000A;    assertContainsAllGames(games);&#x000A;}</code></pre>
          <p>Para que funcione JPA también necesita una Persistence Unit.</p>
          <p>Definimos la Persistence Unit en un fichero test-persistence.xml que corresponde con el contenedor de destino del test. ShrinkWrap coge este fichero del classpath y lo pone en la ubicación estándar dentro del despliegue.</p>
          <pre class="prettify"><code class="prettify">.addAsResource("test-persistence.xml", "META-INF/persistence.xml")</code></pre>
          <p>A continuación tienes la estructura del despliegue que ShrinkWrap prepara para este caso de test (menos la infraestructura de Arquillian):</p>
          <ul class="filetree">
          	<li>WEB-INF/
          	<ul>
          		<li>beans.xml</li>
          		<li>classes/
          		<ul>
          			<li>META-INF/
          			<ul>
          				<li>persistence.xml</li>
          			</ul></li>
          			<li>org/
          			<ul>
          				<li>arquillian/
          				<ul>
          					<li>example/
          					<ul>
          						<li>Game.class</li>
          						<li>GamePersistenceTestCase.class</li>
          						<li>Game_.class</li>
          					</ul></li>
          				</ul></li>
          			</ul></li>
          		</ul></li>
          		<li>lib/
          		<ul>
          			<li>*.jar</li>
          		</ul></li>
          	</ul></li>
          </ul>
          <p>Echemos un vistazo al descriptor de la Persistence Unit que vamos a usar en el test, comenzando por la del Glassfish embebido.</p>
          <h3 id="configurar_la_persistencia_para_glassfish">Configurar la persistencia para GlassFish</h3>
          <p>Aquí está el descriptor de la Persistence Unit que usaremos para el Glassfish embebido:</p>
          <div class="filename">src/test/resources-glassfish-embedded/test-persistence.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;persistence version="2.0" xmlns="http://java.sun.com/xml/ns/persistence"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://java.sun.com/xml/ns/persistence&#x000A;        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;&#x000A;    &lt;persistence-unit name="test"&gt;&#x000A;        &lt;jta-data-source&gt;jdbc/arquillian&lt;/jta-data-source&gt;&#x000A;        &lt;properties&gt;&#x000A;            &lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;&#x000A;            &lt;property name="eclipselink.logging.level.sql" value="FINE"/&gt;&#x000A;            &lt;property name="eclipselink.logging.parameters" value="true"/&gt;&#x000A;        &lt;/properties&gt;&#x000A;    &lt;/persistence-unit&gt;&#x000A;&lt;/persistence&gt;</code></pre>
          <p>Ponemos dos propiedades especificas del fabricante(vendor-specific) para activar funcionalidades del proveedor JPA incorporado, EclipseLink:</p>
          <dl>
          	<dt>eclipselink.ddl-generation</dt>
          	<dd>Configura el comando de creación del esquema de base de datos. El valor <em>drop-and-create-tables</em> le dice a EclipseLink que genere la base de datos, acorde a las entidades de JPA declaradas, en cada ejecución.</dd>
          	<dt>eclipselink.logging.level.sql</dt>
          	<dd>Configura las trazas de las consultas. El valor <em>FINE</em> activa las trazas de las sentencias SQL, permitiéndonos monitorizar la actividad de la base de datos.</dd>
          </dl>
          <p>Las trazas de EclipseLink se tienen que terminar de configurar activando el nivel de traza FINE en la configuración de las trazas de Java(Java logging).</p>
          <div class="filename">src/test/resources-glassfish-embedded/logging.properties</div>
          <pre class="prettify"><code class="prettify">handlers=java.util.logging.ConsoleHandler&#x000A;java.util.logging.ConsoleHandler.formatter=java.util.logging.SimpleFormatter&#x000A;java.util.logging.SimpleFormatter.format=%4$s: %5$s%n&#x000A;java.util.logging.ConsoleHandler.level=FINEST</code></pre>
          <p>La Persistence Unit es test-persistence.xml y se refiere a un DataSource que se llama jdbc/arquillian. ¿Dónde está eso definido? Ah, eso es algo que el adaptador del contenedor de Arquillian tiene que preparar.</p>
          <p>Tenemos que usar el API de GlassFish para crear un pool de conexiones JDBC y los recursos asociados. Pero no queremos tener que escribir código. Queremos simplemente declararlo. Aquí es dónde Arquillian aparece en escena.</p>
          <p>Primero creamos un fichero glassfish-resources.xml que contenga las definiciones de los recursos(resources), el cual GlassFish sabe procesar.</p>
          <div class="filename">src/test/resources-glassfish-embedded/glassfish-resources.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;!DOCTYPE resources PUBLIC&#x000A;    "-//GlassFish.org//DTD GlassFish Application Server 3.1 Resource Definitions//EN"&#x000A;    "http://glassfish.org/dtds/glassfish-resources_1_5.dtd"&gt;&#x000A;&lt;resources&gt;&#x000A;    &lt;jdbc-resource pool-name="ArquillianEmbeddedDerbyPool"&#x000A;        jndi-name="jdbc/arquillian"/&gt;&#x000A;    &lt;jdbc-connection-pool name="ArquillianEmbeddedDerbyPool"&#x000A;        res-type="javax.sql.DataSource"&#x000A;        datasource-classname="org.apache.derby.jdbc.EmbeddedDataSource"&#x000A;        is-isolation-level-guaranteed="false"&gt;&#x000A;        &lt;property name="databaseName" value="target/databases/derby"/&gt;&#x000A;        &lt;property name="createDatabase" value="create"/&gt;&#x000A;    &lt;/jdbc-connection-pool&gt;&#x000A;&lt;/resources&gt;</code></pre>
          <p>Hemos aislado la definición del DataSource del test, al igual que hacemos con la aplicación principal. El beneficio último es que podemos definir todos los recursos que podamos necesitar para nuestro test. Imagina las posibilidades.</p>
          <p>Ahora tenemos que decirle a Arquillian que use este fichero. Abrimos la configuración de Arquillian y configuramos el adaptador para el contenedor GlassFish embebido para que use este fichero, el cual más tarde se lo pasará al comando <code>add-resources</code> del API de administración de GlassFish.</p>
          <div class="filename">src/test/resources/arquillian.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;arquillian xmlns="http://jboss.org/schema/arquillian"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://jboss.org/schema/arquillian&#x000A;        http://jboss.org/schema/arquillian/arquillian_1_0.xsd"&gt;&#x000A;    &lt;container qualifier="glassfish-embedded" default="true"&gt;&#x000A;        &lt;configuration&gt;&#x000A;            &lt;property name="resourcesXml"&gt;&#x000A;                src/test/resources-glassfish-embedded/glassfish-resources.xml&#x000A;            &lt;/property&gt;&#x000A;        &lt;/configuration&gt;&#x000A;    &lt;/container&gt;&#x000A;&lt;/arquillian&gt;</code></pre>
          <p>Por otro lado, puedes también saltarte la configuración del DataSource y, simplemente, incluir la información de la conexión a la base de datos directamente en test-persistence.xml, usando propiedades estándar de la conexión a la base de datos:</p>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;persistence version="2.0" xmlns="http://java.sun.com/xml/ns/persistence"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://java.sun.com/xml/ns/persistence&#x000A;        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;&#x000A;    &lt;persistence-unit name="test"&gt;&#x000A;        &lt;properties&gt;&#x000A;            &lt;property name="javax.persistence.jdbc.driver"&#x000A;                value="org.apache.derby.jdbc.EmbeddedDriver"/&gt;&#x000A;            &lt;property name="javax.persistence.jdbc.url"&#x000A;                value="jdbc:derby:target/databases/derby;create=true"/&gt;&#x000A;            &lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;&#x000A;            &lt;property name="eclipselink.logging.level.sql" value="FINE"/&gt;&#x000A;            &lt;property name="eclipselink.logging.parameters" value="true"/&gt;&#x000A;        &lt;/properties&gt;&#x000A;    &lt;/persistence-unit&gt;&#x000A;&lt;/persistence&gt;</code></pre>
          <p>En todo caso recuerda que cambiar de un DataSource JNDI a una conexión de base de datos explícita te cambia la arquitectura entre el entorno de producción y el de test, por lo tanto te da menos confianza de que tu test va a capturar todos los fallos potenciales.</p>
          <p>Ya simplemente queda configurar el adaptador del contenedor y ejecutar el test.</p>
          <h3 id="preparar_el_test_para_glassfish">Preparar el test para GlassFish</h3>
          <p>Vamos a separar los contenedores para los tests usando perfiles de Maven. Todos los perfiles comparten un grupo común de dependencias (tal y como ya configuramos en la <a href="/guides/getting_started_es/">Guía Inicial</a>):</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;dependencyManagement&gt;&#x000A;    &lt;dependencies&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.arquillian&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;arquillian-bom&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0.0.Final&lt;/version&gt;&#x000A;            &lt;scope&gt;import&lt;/scope&gt;&#x000A;            &lt;type&gt;pom&lt;/type&gt;&#x000A;        &lt;/dependency&gt;&#x000A;    &lt;/dependencies&gt;&#x000A;&lt;/dependencyManagement&gt;&#x000A;&lt;dependencies&gt;&#x000A;    &lt;dependency&gt;&#x000A;        &lt;groupId&gt;junit&lt;/groupId&gt;&#x000A;        &lt;artifactId&gt;junit&lt;/artifactId&gt;&#x000A;        &lt;version&gt;4.8.1&lt;/version&gt;&#x000A;    &lt;/dependency&gt;&#x000A;    &lt;dependency&gt;&#x000A;        &lt;groupId&gt;org.jboss.arquillian.junit&lt;/groupId&gt;&#x000A;        &lt;artifactId&gt;arquillian-junit-container&lt;/artifactId&gt;&#x000A;        &lt;scope&gt;test&lt;/scope&gt;&#x000A;    &lt;/dependency&gt;&#x000A;&lt;/dependencies&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p class="warning"><span>Si estás pensando utilizar una base de datos que no esté incluída en el contenedor, como por ejemplo MySQL, tienes que también incluir sus librerias cliente en el classpath. Mira en <a href="http://github.com/arquillian/arquillian-examples/tree/master/arquillian-persistence-tutorial">sample project</a> y encontrarás ejemplos de cómo usar la base de datos H2 en lugar de Derby.</span></p>
          <p>Ahora añade (o modifica) el perfil para el GlassFish embebido:</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;profile&gt;&#x000A;    &lt;id&gt;arquillian-glassfish-embedded&lt;/id&gt;&#x000A;    &lt;activation&gt;&#x000A;        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;&#x000A;    &lt;/activation&gt;&#x000A;    &lt;dependencies&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;arquillian-glassfish-embedded-3.1&lt;/artifactId&gt;&#x000A;            &lt;version&gt;1.0.0.CR3&lt;/version&gt;&#x000A;        &lt;/dependency&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.glassfish.main.extras&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;glassfish-embedded-web&lt;/artifactId&gt;&#x000A;            &lt;version&gt;3.1.2&lt;/version&gt;&#x000A;        &lt;/dependency&gt;&#x000A;    &lt;/dependencies&gt;&#x000A;    &lt;build&gt;&#x000A;        &lt;testResources&gt;&#x000A;            &lt;testResource&gt;&#x000A;                &lt;directory&gt;src/test/resources&lt;/directory&gt;&#x000A;            &lt;/testResource&gt;&#x000A;            &lt;testResource&gt;&#x000A;                &lt;directory&gt;src/test/resources-glassfish-embedded&lt;/directory&gt;&#x000A;            &lt;/testResource&gt;&#x000A;        &lt;/testResources&gt;&#x000A;        &lt;plugins&gt;&#x000A;            &lt;plugin&gt;&#x000A;                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;&#x000A;                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;&#x000A;                &lt;version&gt;2.12&lt;/version&gt;&#x000A;                &lt;configuration&gt;&#x000A;                    &lt;systemPropertyVariables&gt;&#x000A;                        &lt;java.util.logging.config.file&gt;&#x000A;                            ${project.build.testOutputDirectory}/logging.properties&#x000A;                        &lt;/java.util.logging.config.file&gt;&#x000A;                        &lt;derby.stream.error.file&gt;&#x000A;                            ${project.build.directory}/derby.log&#x000A;                        &lt;/derby.stream.error.file&gt;&#x000A;                    &lt;/systemPropertyVariables&gt;&#x000A;                &lt;/configuration&gt;&#x000A;            &lt;/plugin&gt;&#x000A;        &lt;/plugins&gt;&#x000A;    &lt;/build&gt;&#x000A;&lt;/profile&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p>Estamos añadiendo explícitamente el directorio src/test/resources-glassfish-embedded como un directorio de recursos para los test, de manera que el fichero test-persistence.xml se incluya en el classpath. Hemos configurado tambien el plugin <em>surefire</em> para que le pase el fichero de configuracion de Java Logging al nuevo proceso para que las trazas de SQL funcionen. Finalmente colocamos el fichero de trazas de Derby en el directorio de salida para que desaparezca cuando limpiemos el proyecto.</p>
          <p class="info"><span>Si no está en tus planes probar con diferentes contenedores no necesitas meter la configuración anterior dentro de perfiles.</span></p>
          <h3 id="ejecuta_el_test_en_glassfish">Ejecuta el test en Glassfish</h3>
          <p>Ahora que ya has terminado de configurarlo todo puedes ejecutar el test en el IDE seleccionando Run As &gt; JUnit Test o desde Maven usando el siguiente comando:</p>
          <pre class="command"><code class="command">$ mvn clean test</code></pre>
          <p>El perfil de Maven para el GlassFish embebido está activado por defecto (al igual que lo está la configuración de adaptador de contenedor en arquillian.xml). Debajo puedes ver fragmentos de la salida del test.</p>
          <pre class="output"><code class="output">...&#x000A;Running org.arquillian.example.GamePersistenceTest&#x000A;...&#x000A;INFO: GlassFish Server Open Source Edition 3.1.2 (java_re-private) ...&#x000A;...&#x000A;INFO: command add-resources result: PlainTextActionReporterSUCCESSDescription: add-resources AdminCommandnull&#x000A;    JDBC connection pool ArquillianEmbeddedDerbyPool created successfully.&#x000A;    JDBC resource jdbc/arquillian created successfully.&#x000A;...&#x000A;INFO: WEB0671: Loading application [test] at [/test]&#x000A;...&#x000A;Dumping old records...&#x000A;FINE: DELETE FROM GAME&#x000A;Inserting records...&#x000A;FINE: UPDATE SEQUENCE SET SEQ_COUNT = SEQ_COUNT + ? WHERE SEQ_NAME = ?&#x000A;   bind =&gt; [50, SEQ_GEN]&#x000A;FINE: SELECT SEQ_COUNT FROM SEQUENCE WHERE SEQ_NAME = ?&#x000A;   bind =&gt; [SEQ_GEN]&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [3, F-Zero]&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [1, Super Mario Brothers]&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [2, Mario Kart]&#x000A;Selecting (using JPQL)...&#x000A;FINE: SELECT ID, TITLE FROM GAME ORDER BY ID ASC&#x000A;Found 3 games (using JPQL):&#x000A;* Game@599290122[id = 1; title = Super Mario Brothers]&#x000A;* Game@1550721071[id = 2; title = Mario Kart]&#x000A;* Game@1107500305[id = 3; title = F-Zero]&#x000A;FINE: DELETE FROM GAME&#x000A;Inserting records...&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [5, Mario Kart]&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [6, F-Zero]&#x000A;FINE: INSERT INTO GAME (ID, TITLE) VALUES (?, ?)&#x000A;   bind =&gt; [4, Super Mario Brothers]&#x000A;Selecting (using Criteria)...&#x000A;FINE: SELECT ID, TITLE FROM GAME ORDER BY ID ASC&#x000A;Found 3 games (using Criteria):&#x000A;* Game@1020493092[id = 4; title = Super Mario Brothers]&#x000A;* Game@1622992302[id = 5; title = Mario Kart]&#x000A;* Game@294335520[id = 6; title = F-Zero]&#x000A;...</code></pre>
          <p><strong>¡Enhorabuena!</strong> <strong class="greenbar">¡Barra verde!</strong> <em>¡Esto sí es un test de integración real!</em></p>
          <p class="important"><span>Según vayas introduciendo mapeos(mappings) JPA avanzados, tales como cargas diferidas(lazy) o grupos de carga(fetch groups), puede que te encuentres con errores provocados por el GlassFish embebido por que interfiera con la inicialización necesaria de EclipseLink. Es necesaria configuración adicional para sortear el problema. Consulta el <a href="http://blog.eisele.net/2012/01/arquillian-with-netbeans-glassfish_18.html">blog de Markus Eisele&#8217;s</a> si quieres instrucciones. No te encontrarás con este problema usando adaptadores para contenedores remotos o administrados.</span></p>
          <h3 id="ejecutar_el_test_en_jboss_as_7">Ejecutar el test en JBoss AS 7</h3>
          <p>Podemos ejecutar exactamente el mismo test en JBoss AS 7 simplemente con un par de cambios en el classpath.</p>
          <p>Primero necesitamos una definición de Persistence Unit diferente que especifique un DataSource que esté disponible en JBoss AS (y opcionalmente que ponga algunas opciones de configuración de Hibernate)</p>
          <p>Si fueras a usar JBoss AS 7.0 necesitarías <a href="https://docs.jboss.org/author/display/AS7/Admin+Guide#AdminGuide-Datasources">configurar un DataSource a mano en la configuracion de JBoss</a> o usar el DataSource incorporado: java:jboss/datasources/ExampleDS. Aquí está el descriptor de la Persistence Unit para JBoss AS 7.0 que usa el DataSource incorporado.</p>
          <div class="filename">src/test/resources-jbossas-managed/test-persistence.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;persistence version="2.0" xmlns="http://java.sun.com/xml/ns/persistence"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://java.sun.com/xml/ns/persistence&#x000A;        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;&#x000A;    &lt;persistence-unit name="test"&gt;&#x000A;        &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;&#x000A;        &lt;properties&gt;&#x000A;            &lt;property name="hibernate.hbm2ddl.auto" value="create-drop"/&gt;&#x000A;            &lt;property name="hibernate.show_sql" value="true"/&gt;&#x000A;        &lt;/properties&gt;&#x000A;    &lt;/persistence-unit&gt;&#x000A;&lt;/persistence&gt;</code></pre>
          <p>Las propiedades específicas de hibernate hibernate.hbm2ddl.auto y hibernate.show_sql realizan las mismas funciones que las propiedades de EclipseLink descritas anteriormente.</p>
          <p>Si vas a usar JBoss AS 7.1, lo que recomendamos, puedes registrar un nuevo DataSource dinámicamente añadiendo un descriptor de DataSource (ej: un fichero con la extension -ds.xml), conteniendo una o más definiciones de DataSource, al directorio META-INF, en el caso de un archivo java, o al directorio WEB-INF en el caso de un archivo web.</p>
          <p>Aquí viene un descriptor que define un DataSource de H2 con el nombre JNDI jdbc/arquillian (el mismo nombre JNDI que el DataSource que definimos antes para el GlassFish):</p>
          <div class="filename">src/test/resources/jbossas-ds.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;datasources xmlns="http://www.jboss.org/ironjacamar/schema"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://www.jboss.org/ironjacamar/schema&#x000A;        http://docs.jboss.org/ironjacamar/schema/datasources_1_0.xsd"&gt;&#x000A;    &lt;datasource enabled="true"&#x000A;        jndi-name="jdbc/arquillian"&#x000A;        pool-name="ArquillianEmbeddedH2Pool"&gt;&#x000A;        &lt;connection-url&gt;jdbc:h2:mem:arquillian;DB_CLOSE_DELAY=-1&lt;/connection-url&gt;&#x000A;        &lt;driver&gt;h2&lt;/driver&gt;&#x000A;    &lt;/datasource&gt;&#x000A;&lt;/datasources&gt;</code></pre>
          <p class="info"><span>JBoss AS 7.1 trae soporte incluido para la base de datos H2. Para poder usar otra base de datos necesitas añadir el controlador correspondiente a la instalación, tal y como se describe en el <a href="https://docs.jboss.org/author/display/AS71/Admin+Guide#AdminGuide-Datasources">capítulo sobre DataSources de la guía de referencia de JBoss AS 7.1</a>.</span></p>
          <p>Necesitamos actualizar nuestra Persistence Unit para que haga referencia a nuestro nuevo DataSource:</p>
          <div class="filename">src/test/resources-jbossas-managed/test-persistence.xml</div>
          <pre class="prettify"><code class="prettify">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&#x000A;&lt;persistence version="2.0" xmlns="http://java.sun.com/xml/ns/persistence"&#x000A;    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&#x000A;    xsi:schemaLocation="&#x000A;        http://java.sun.com/xml/ns/persistence&#x000A;        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;&#x000A;    &lt;persistence-unit name="test"&gt;&#x000A;        &lt;jta-data-source&gt;jdbc/arquillian&lt;/jta-data-source&gt;&#x000A;        &lt;properties&gt;&#x000A;            &lt;property name="hibernate.hbm2ddl.auto" value="create-drop"/&gt;&#x000A;            &lt;property name="hibernate.show_sql" value="true"/&gt;&#x000A;        &lt;/properties&gt;&#x000A;    &lt;/persistence-unit&gt;&#x000A;&lt;/persistence&gt;</code></pre>
          <p>También tenemos que añadir el descriptor al directorio WEB-INF del archivo de test. Añade el siguiente método a la construcción del archivo de ShrinkWrap en el método  <code>@Deployment</code></p>
          <pre class="prettify"><code class="prettify">.addAsWebInfResource("jbossas-ds.xml")</code></pre>
          <p>Incluir este fichero en el archivo de despliegue no afecta a la capacidad de ejecutar este test en GlassFish embebido. El DataSource y la Persistence Unit están listos.</p>
          <p>Lo siguiente que haremos será definir un nuevo perfil de Maven que ponga el adaptador de contenedor para JBoss AS, así como el directorio de recursos del JBoss, en el classpath:</p>
          <div class="filename">pom.xml</div>
          <pre class="prettify"><code class="prettify">&lt;!-- clip --&gt;&#x000A;&lt;profile&gt;&#x000A;    &lt;id&gt;arquillian-jbossas-managed&lt;/id&gt;&#x000A;    &lt;dependencies&gt;&#x000A;        &lt;dependency&gt;&#x000A;            &lt;groupId&gt;org.jboss.as&lt;/groupId&gt;&#x000A;            &lt;artifactId&gt;jboss-as-arquillian-container-managed&lt;/artifactId&gt;&#x000A;            &lt;version&gt;7.1.1.Final&lt;/version&gt;&#x000A;            &lt;scope&gt;test&lt;/scope&gt;&#x000A;        &lt;/dependency&gt;&#x000A;         &lt;dependency&gt;&#x000A;             &lt;groupId&gt;org.jboss.spec&lt;/groupId&gt;&#x000A;             &lt;artifactId&gt;jboss-javaee-web-6.0&lt;/artifactId&gt;&#x000A;             &lt;version&gt;3.0.0.Final&lt;/version&gt;&#x000A;             &lt;type&gt;pom&lt;/type&gt;&#x000A;             &lt;scope&gt;provided&lt;/scope&gt;&#x000A;             &lt;exclusions&gt;&#x000A;                 &lt;exclusion&gt;&#x000A;                     &lt;groupId&gt;xalan&lt;/groupId&gt;&#x000A;                     &lt;artifactId&gt;xalan&lt;/artifactId&gt;&#x000A;                 &lt;/exclusion&gt;&#x000A;             &lt;/exclusions&gt;&#x000A;         &lt;/dependency&gt;&#x000A;    &lt;/dependencies&gt;&#x000A;    &lt;build&gt;&#x000A;        &lt;testResources&gt;&#x000A;            &lt;testResource&gt;&#x000A;                &lt;directory&gt;src/test/resources&lt;/directory&gt;&#x000A;            &lt;/testResource&gt;&#x000A;            &lt;testResource&gt;&#x000A;                &lt;directory&gt;src/test/resources-jbossas-managed&lt;/directory&gt;&#x000A;            &lt;/testResource&gt;&#x000A;        &lt;/testResources&gt;&#x000A;    &lt;/build&gt;&#x000A;&lt;/profile&gt;&#x000A;&lt;!-- clip --&gt;</code></pre>
          <p>Ahora podemos ejecutar el test de nuevo usando Maven, esta vez activando el perfil de JBoss AS administrado.</p>
          <pre class="command"><code class="command">$ mvn clean test -Parquillian-jbossas-managed</code></pre>
          <p class="warning"><span>Asegúrate de que la variable de entorno JBOSS_HOME apunta a la ubicación de instalación del JBoss AS 7.1.1.Final. También puedes configurar la ubicación usando la propiedad jbossHome en arquillian.xml.</span></p>
          <p>Aquí viene lo bueno. ¡También puedes ejecutar este test desde tu IDE! Simplemente tienes que importar el proyecto, activar el perfil de Maven arquillian-jbossas-managed (y desactivar el perfil arquillian-glassfish-embedded), abrir el caso de test y, finalmente, seleccionar &#8220;Run As &gt; JUnit Test&#8221;. ¡Voila! Funciona como cualquier otro test de JUnit. <strong class="greenbar">¡Barra verde!</strong></p>
          <p><strong>¡Disfruta de la combinación perfecta para probar JPA!</strong></p>
          <p class="info"><span>Aunque hemos tenido que configurar un montón de cosas en la esta guía, hay que reconocer que es por que no hemos dejado velo sin correr. Si necesitas recordar las ventajas de Arquillian vuelve a echar un vistazo a lo simple que es el caso de test. Después recuérdate a ti mismo que no está ligado a ningún contenedor Java EE 6 o implementación de JPA 2.</span></p>
          <h3 id="share">Share the Knowledge</h3>
          <p>Find this guide useful?</p>
          <p class="post_to_twitter"><a href="http://twitter.com/home/?status=Just%20read%20the%20%23Arquillian%20Testing%20Java%20Persistence%20guide%20and%20got%20a%20%23greenbar!%20Get%20yours.%20http://arquillian.org/guides/testing_java_persistence_es/"><img src="/images/post_to_twitter.png" alt="" /></a></p>
          <div class="g-plusone" data-size="tall"></div>
          <p>There&#8217;s a lot more about Arquillian to cover. If you&#8217;re ready to learn more, check out the <a href="/guides">other available guides</a>.</p>
          <h4>Feedback</h4>
          <p>Find a bug in the guide? Something missing? You can fix it by <a href="http://github.com/arquillian/arquillian.github.com">forking this website</a>, making the correction and <a href="http://help.github.com/send-pull-requests">sending a pull request</a>. If you&#8217;re just plain stuck, feel free to ask a question in the <a href="http://community.jboss.org/en/arquillian?view=discussions">user discussion forum</a>.</p>
          <h4>Recent Changelog</h4>
          <ul>
            <li>
              Feb 26, 2017:
              Fixes issues for new versioning scheme
              <em>by Bartosz Majsak</em>
            </li>
          </ul>
          <p>
            <a href="https://github.com/arquillian/arquillian.github.io/commits/develop/guides/testing_java_persistence_es.textile">See full history &raquo;</a>
          </p>
        </div>
        <div id="sidebar">
          <div id="toc">
            <h3 class="chapter_header">Chapters</h3>
            <ol class="chapters">
              <li>
                <a href="#asunciones" id="asunciones_link">Asunciones</a>
              </li>
              <li>
                <a href="#prop&#243;sito" id="propósito_link">Propósito</a>
              </li>
              <li>
                <a href="#estructura_del_proyecto" id="estructura_del_proyecto_link">Estructura del proyecto</a>
              </li>
              <li>
                <a href="#escribir_el_test" id="escribir_el_test_link">Escribir el test</a>
              </li>
              <li>
                <a href="#configurar_la_persistencia_para_glassfish" id="configurar_la_persistencia_para_glassfish_link">Configurar la persistencia para GlassFish</a>
              </li>
              <li>
                <a href="#preparar_el_test_para_glassfish" id="preparar_el_test_para_glassfish_link">Preparar el test para GlassFish</a>
              </li>
              <li>
                <a href="#ejecuta_el_test_en_glassfish" id="ejecuta_el_test_en_glassfish_link">Ejecuta el test en Glassfish</a>
              </li>
              <li>
                <a href="#ejecutar_el_test_en_jboss_as_7" id="ejecutar_el_test_en_jboss_as_7_link">Ejecutar el test en JBoss AS 7</a>
              </li>
              <li>
                <a href="#share" id="share_link">Share the Knowledge</a>
              </li>
            </ol>
          </div>
        </div>
        <script>
          $(window).load(function() { activateScrollingToc(['asunciones', 'propósito', 'estructura_del_proyecto', 'escribir_el_test', 'configurar_la_persistencia_para_glassfish', 'preparar_el_test_para_glassfish', 'ejecuta_el_test_en_glassfish', 'ejecutar_el_test_en_jboss_as_7', 'share']) })
        </script>
      </div>
    </div>
    <footer>
      <div class="container">
        <div class="project">
          <img src="/images/arquillian_logo_200px.png" />
          <p class="bottom">
            &#169;
            Copyright 2009-2017 Red Hat, Inc.
            <br />
            <i class="icon-fire"></i>
            Mixed with <a href="http://twitter.github.com/bootstrap">Bootstrap</a>. Baked by <a href="http://awestruct.org">Awestruct</a>.
            <br />
            <i class="icon-share-alt"></i>
            Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
            <br />
            Code released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>.
          </p>
        </div>
        <div class="footer-nav">
          <h4>Learn</h4>
          <ul>
            <li>
              <a href="/invasion">Mission</a>
            </li>
            <li>
              <a href="/features">Features</a>
            </li>
            <li>
              <a href="/docs">Documentation</a>
            </li>
            <li>
              <a href="/guides">Guides</a>
            </li>
            <li>
              <a href="https://docs.jboss.org/author/display/ARQ/Reference+Guide">Manual</a>
            </li>
            <li>
              <a href="http://community.jboss.org/en/arquillian/faq">FAQs</a>
            </li>
          </ul>
        </div>
        <div class="footer-nav">
          <h4>Get Involved</h4>
          <ul>
            <li>
              <a href="http://community.jboss.org/en/arquillian?view=discussions">Forums</a>
            </li>
            <li>
              <a href="https://issues.jboss.org/browse/ARQ">Issue Tracker</a>
            </li>
            <li>
              <a href="https://github.com/arquillian">Source Code</a>
            </li>
            <li>
              <a href="/community/contributors">Contributors</a>
            </li>
            <li>
              <a href="https://community.jboss.org/groups/testing">Testing SIG</a>
            </li>
          </ul>
        </div>
        <div class="sponser">
          <div class="follow-us">
            <h4>Stay Informed</h4>
            <ul>
              <li>
                <a href="https://plus.google.com/100660127586085393031?rel=author"><img alt="Google+" src="/images/social/googleplus-16.png" title="Follow Arquillian on Google+" /></a>
              </li>
              <li>
                <a href="https://twitter.com/#!/search/%23arquillian"><img alt="Twitter" src="/images/social/twitter-16.png" title="Browse the #arquillian hashtag on Twitter" /></a>
              </li>
              <li>
                <a href="http://www.linkedin.com/groups?gid=3120340"><img alt="LinkedIn" src="/images/social/linkedin-16.png" title="Join the Arquillian group on LinkedIn" /></a>
              </li>
              <li>
                <a href="http://vimeo.com/channels/arquillian"><img alt="Vimeo" src="/images/social/vimeo-16.png" title="Follow the Arquillian channel on Vimeo" /></a>
              </li>
            </ul>
          </div>
          <p>This website is open source! If you want to improve it, <a href="http://github.com/arquillian/arquillian.github.com">fork the project</a>, hack on it, then send a <a href="https://help.github.com/articles/using-pull-requests">pull request</a>. You can also view the <a href="http://www.seethestats.com/site/arquillian.org">visitor stats</a>.</p>
          <p class="image"><a href="http://jboss.org"><img src="/images/jboss_redhat_branding.png" class="branding" title="Red Hat, Inc." alt="Red Hat, Inc." /></a></p>
          <p>Arquillian is a <a href="http://jboss.org">JBoss Community</a> project and development is sponsored by Red Hat, Inc.</p>
          <p class="bottom"><a href="http://www.redhat.com/legal/legal_statement.html">Terms of Use</a> | <a href="http://www.redhat.com/legal/privacy_statement.html">Privacy Policy</a></p>
        </div>
        <a class="visible-desktop" href="#" id="toTop">Top</a>
      </div>
    </footer>
    <script>
      $(function() {
        $('html').addClass('ready');
        prettify();
        activateFooterGravity();
        activateTooltips();
        activateToTopControl();
      });
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.2/bootstrap.min.js"></script>
    <script src="/javascripts/prettify.js"></script>
    <script src="/javascripts/site.js?561598d61dc65317bc7ec8c4030edffad9a55082"></script>
    <script src="/javascripts/jquery-scroll.js"></script>
    <script src="http://apis.google.com/js/plusone.js"></script>
    <script>
      (function() {
        var po = document.createElement('script'); po.async = true; po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount','UA-18727998-3']);
    _gaq.push(['_trackPageview']);
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>
